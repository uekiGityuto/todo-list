# ユーザーフロー設計

## 概要

タスクのライフサイクル（追加→作業開始→完了）と各画面の操作フローを定義する。

## ステータス: 確定済み

## タスクモデル

### ステータス（状態遷移）

```
[未着手] ──→ [作業中] ──→ [完了]
```

| ステータス | 説明 |
|-----------|------|
| 未着手 | まだ一度も作業していない |
| 作業中 | 作業したことがある（タイマー稼働中 or 中断済み、どちらも含む） |
| 完了 | 作業終了。カレンダーに記録される |

- 「作業中」はタイマーが今動いているかどうかを問わない。一度でも作業したら「作業中」
- タイマーの稼働状態はランタイムで管理（ステータスとは別）
- 中断してもステータスは「作業中」のまま残る

### 「次やる」マーク（フラグ）

- ステータスとは独立したフラグ。1つのタスクにだけ付与できる
- ホーム画面にデカデカ表示される
- 推奨であり強制ではない。別タスクから作業を始めても「次やる」マークは変わらない
- 別のタスクに付け替えると、前のタスクからはマークが外れる
- 完了したタスクからはマークが自動で外れる

## フロー定義

### フロー1: タスク追加

- **場所**: タスク一覧画面の「+追加」ボタン
- **入力項目**:
  - タスク名（必須）
  - カテゴリ（任意）
  - 予定日（任意）— 設定するとホームの「今日のタスク」に表示される
  - 見積もり時間（任意）
- **追加後**: タスク一覧に「未着手」として追加

### フロー2: 「次やる」設定

- **場所**: タスク一覧画面
- **操作**: タスクカードをタップ → 「次やるに設定」
- **制約**: 同時に1つだけ。別のタスクを「次やる」にすると、前のタスクは「未着手」に戻る
- **結果**: ホーム画面のNextTaskHeroに即反映

### フロー3: 作業開始

**パターンA: ホーム画面から（メイン導線）**
1. ホーム画面でNextTaskHeroの「作業を始める」をタップ
2. タイマー画面に遷移、タイマースタート

**パターンB: タスク一覧から（任意のタスク）**
1. タスク一覧で任意のタスクをタップ → 「作業を始める」
2. タイマー画面に遷移、タイマースタート
3. 「次やる」マークは変わらない

**タイマー時間のルール**:
- 見積もり時間が設定済み → その時間でカウントダウン
- 見積もり時間が未設定 → **1時間**でカウントダウン
- タイマーなしの作業は不可（必ずタイマーが動く）

### フロー4: タイマー動作中

- モバイル: タイマー画面が全面表示（タブバーで他画面に遷移可能）
- PC: 画面内にタイマー簡易表示（PiPは将来対応 → [002-pc-pip-timer.md](002-pc-pip-timer.md)）
- 途中操作ボタン:
  - **完了する** → タイマー停止 → 完了処理（ステータスを「完了」に）
  - **中断する** → タイマー停止 → 中断処理（ステータスは「作業中」のまま）
- ブラウザを閉じた場合:
  - タイマー開始時にセッション情報（タスクID、開始時刻）をローカルストレージに保存
  - 次回起動時に未完了セッションを検知 → 「前回の作業どうしますか？」ダイアログ（完了/中断）

### フロー5: タイマー終了時（カウントダウンが0になった場合）

終了ダイアログで3択を表示:

| 選択 | タスク状態 | 作業時間 | 遷移先 |
|------|----------|---------|--------|
| **完了** | 完了 | カレンダーに記録 | ホーム |
| **継続** | 作業中のまま | - | タイマーリスタート（同じ時間） |
| **中断** | 作業中のまま | カレンダーに記録 | ホーム |

### フロー6: カレンダー（作業記録）

- 日付ごとに完了・中断した作業を表示
- 作業時間も記録（例: 「インスタ投稿作成 25分」）
- 日付タップで詳細表示

## 現状の課題（解決済み）

以下はフロー設計前に挙げた課題。上記フローで全て解決。

1. ~~「次やる」以外のタスクから作業を始められない~~ → フロー3 パターンBで対応
2. ~~「次やる」タスクの設定方法が不明~~ → フロー2で定義
3. ~~タスク追加画面がない~~ → フロー1で定義
4. ~~作業開始後の状態遷移が不明~~ → フロー3〜5で定義
5. ~~完了/中断の操作が不明~~ → フロー4〜5で定義
6. ~~タイマーとの連携~~ → フロー3〜5で定義（タイマーは必須）
7. ~~PC版タイマーの扱い~~ → 初期は画面内簡易表示、PiPは別issue

## 次のステップ

- [ ] フローに基づくUIデザイン調整（`designs/todo-app.pen`）
  - タスク一覧: タスクタップ時のアクション（次やる設定/作業開始/編集/削除）
  - タスク追加モーダル
  - タイマー終了ダイアログ（完了/継続/中断の3択）
  - PC版タイマー簡易表示
